<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Arduino Temp & Humidity Live Graph</title>
    <link rel="stylesheet" href="./styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3"></script>
  </head>
  <body>
    <header>
      <h1>Live Temperature & Humidity</h1>
      <div class="controls">
        <label>
          Baud rate
          <select id="baudRate">
            <option value="9600" selected>9600</option>
            <option value="19200">19200</option>
            <option value="38400">38400</option>
            <option value="57600">57600</option>
            <option value="115200">115200</option>
          </select>
        </label>
        <div class="divider"></div>
        <button id="connectBtn">Connect</button>
        <button id="disconnectBtn" disabled>Disconnect</button>
        <button id="settingsBtn" class="icon-btn" title="Settings" aria-label="Settings">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z" stroke="currentColor" stroke-width="1.6"/>
            <path d="M19.4 15a1 1 0 0 0 .2 1.1l.1.1a1 1 0 0 1-1.4 1.4l-.1-.1a1 1 0 0 0-1.1-.2 1 1 0 0 0-.6.9V18a1 1 0 0 1-1 1h-1a1 1 0 0 0-.9.6 1 1 0 0 0 .2 1.1l.1.1a1 1 0 1 1-1.4 1.4l-.1-.1a1 1 0 0 0-1.1-.2 1 1 0 0 0-.6.9V23a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-.1a1 1 0 0 0-.6-.9 1 1 0 0 0-1.1.2l-.1.1a1 1 0 1 1-1.4-1.4l.1-.1a1 1 0 0 0 .2-1.1 1 1 0 0 0-.9-.6H2a1 1 0 0 1-1-1v-1c0-.4.2-.8.6-.9a1 1 0 0 0 1.1-.2l.1-.1a1 1 0 1 0-1.4-1.4l-.1.1a1 1 0 0 1-1.4-1.4l.1-.1a1 1 0 0 0 .2-1.1A1 1 0 0 0 0 12v-1a1 1 0 0 1 1-1h1c.4 0 .8.2.9.6a1 1 0 0 0 .6.9 1 1 0 0 0 1.1-.2l.1-.1A1 1 0 1 0 4.3 9l-.1.1a1 1 0 0 1-1.4-1.4l.1-.1A1 1 0 0 0 3.1 6 1 1 0 0 0 2.2 5.4L2.1 5.3A1 1 0 0 1 3.5 4l.1.1a1 1 0 0 0 1.1.2c.4-.2.6-.6.6-1V3a1 1 0 0 1 1-1h1c.4 0 .8.2.9.6a1 1 0 0 0 .6.9 1 1 0 0 0 1.1-.2l.1-.1A1 1 0 0 1 12 2a1 1 0 0 1 .7.3l.1.1a1 1 0 0 0 1.1.2 1 1 0 0 0 .6-.9V1a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v.1c0 .4.2.8.6.9.4.2.8.1 1.1-.2l.1-.1A1 1 0 1 1 20.9 3l-.1.1a1 1 0 0 0-.2 1.1c.2.4.6.6 1 .6H22a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1h-.1c-.4 0-.8.2-.9.6a1 1 0 0 0 .2 1.1l.1.1a1 1 0 1 1-1.4 1.4l-.1-.1a1 1 0 0 0-1.1-.2c-.4.2-.6.6-.6 1v1c0 .4.2.8.6.9.4.2.8.1 1.1-.2l.1-.1a1 1 0 1 1 1.4 1.4l-.1.1c-.3.2-.7.3-1.1.2h-.1c-.4 0-.8.2-.9.6Z" stroke="currentColor" stroke-width="0.6" opacity="0.5"/>
          </svg>
        </button>
        <span id="connBadge" class="badge err">Disconnected</span>
      </div>
    </header>

    <section class="stats">
      <div class="stat two-cols">
        <div class="main">
          <div class="label">Temperature</div>
          <div class="value"><span id="tempValue">--</span> °C</div>
        </div>
        <div class="side">
          <div class="side-label">Avg</div>
          <div class="side-value" id="tempAvgValue">—</div>
          <div class="delta" id="tempDelta"></div>
        </div>
      </div>
      <div class="stat two-cols">
        <div class="main">
          <div class="label">Humidity</div>
          <div class="value"><span id="humValue">--</span> %</div>
        </div>
        <div class="side">
          <div class="side-label">Avg</div>
          <div class="side-value" id="humAvgValue">—</div>
          <div class="delta" id="humDelta"></div>
        </div>
      </div>
    </section>

    <section class="history-bar">
      <div class="left">
        <label>Range
          <select id="rangeSelect">
            <option value="live" selected>Live</option>
            <option value="1h">Last 1 hour</option>
            <option value="6h">Last 6 hours</option>
            <option value="24h">Last 24 hours</option>
            <option value="7d">Last 7 days</option>
            <option value="all">All</option>
          </select>
        </label>
        <span id="liveWindowWrap">
          <label>Live window
            <select id="liveWindowSelect">
              <option value="30000">30 sec</option>
              <option value="60000">1 min</option>
              <option value="120000" selected>2 min</option>
              <option value="300000">5 min</option>
              <option value="600000">10 min</option>
            </select>
          </label>
        </span>
      </div>
      <div class="right">
        <span id="updatedLabel" class="muted">Updated —</span>
        <label class="checkbox"><input type="checkbox" id="toggleGraph" checked /> Show graph</label>
        <label class="checkbox"><input type="checkbox" id="toggleRaw" /> Show raw serial</label>
        <button id="exportCsvBtn">Export CSV</button>
      </div>
    </section>

    <section class="panes">
      <div class="panel chart-panel" id="chartPanel">
        <canvas id="chart" height="400"></canvas>
      </div>
      <div class="panel console-panel" id="rawPanel" hidden>
        <div class="panel-header">
          <h2>Raw Serial</h2>
          <div class="panel-actions">
            <label class="checkbox"><input type="checkbox" id="autoscroll" checked /> Autoscroll</label>
            <button id="copyRaw">Copy</button>
            <button id="clearRawLog">Clear</button>
          </div>
        </div>
        <pre id="rawLog" class="raw"></pre>
      </div>
    </section>

    <!-- Settings modal -->
    <div id="settingsModal" class="modal" hidden>
      <div class="dialog">
        <div class="dialog-header">
          <h3>Settings</h3>
          <button id="closeSettingsBtn" class="icon-btn">×</button>
        </div>
        <div class="dialog-body">
          <div class="group">
            <h4>Device</h4>
            <label>Sample ms
              <input id="settingsSampleMs" type="number" min="1000" step="100" value="1000" />
            </label>
            <button id="settingsApplySample">Apply</button>
          </div>
          <div class="group">
            <h4>View</h4>
            <button id="clearViewBtn">Clear live view</button>
            <button id="clearRawInSettings">Clear raw console</button>
          </div>
          <div class="group">
            <h4>History</h4>
            <p class="muted">Stored locally every minute.</p>
            <button id="clearHistoryBtn" class="danger">Clear stored history</button>
          </div>
        </div>
        <div class="dialog-footer">
          <button id="closeSettingsBtn2">Close</button>
        </div>
      </div>
    </div>

    <noscript>
      This page requires JavaScript. Also, your browser must support the Web Serial API (Chrome/Edge).
    </noscript>

    <script src="./app.js" type="module"></script>
  </body>
  </html>


